<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lux-Ai - Analisi Rischi Legali (MVP Accessibile)</title>
    <style>
        :root {
            --brand-color: #3F93E6;
            --background-main: #2c3e50;
            --background-light: #ffffff;
            --cta-color: #38c172;
            --font-stack: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --text-dark: #2c3e50;
            --text-light: #666;
            --border-radius: 6px;
        }

        body {
            font-family: var(--font-stack);
            background-color: var(--background-main);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            font-size: 16px;
        }
        .top-bar {
            width: 100%;
            background-color: var(--background-light);
            color: var(--text-dark);
            padding: 18px 50px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
        }
        .logo { font-size: 1.4em; font-weight: 800; flex-shrink: 0; color: var(--brand-color); }
        .top-bar-pitch { text-align: center; flex-grow: 1; }
        .top-bar-pitch h1 { font-size: 1.25em; font-weight: 700; color: var(--text-dark); margin: 0; line-height: 1.2; }
        .top-bar-pitch p { color: var(--text-light); font-size: 0.85em; margin: 2px 0 0 0; }
        .top-bar-nav { flex-shrink: 0; font-size: 0.9em; }
        .top-bar-nav a { color: var(--brand-color); text-decoration: none; margin-left: 15px; cursor: pointer; }
        
        /* Contenitore principale della CARD */
        .content-card {
            max-width: 1200px; width: 95%; margin: 40px 20px; background-color: var(--background-light);
            color: var(--text-dark); padding: 35px; border-radius: var(--border-radius);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2); box-sizing: border-box;
        }
        
        /* 1. LAYOUT INIZIALE: Solo upload (singola colonna) */
        .single-column-layout {
            display: flex; 
            justify-content: center;
            align-items: flex-start;
            min-height: 400px;
        }
        
        /* 2. LAYOUT REPORT: Due colonne ampliate */
        .report-columns-layout { 
            display: none; /* Inizialmente nascosto */
            grid-template-columns: 1fr 2fr; 
            gap: 30px; 
            margin-top: 15px; /* Spazio sotto la barra di navigazione del report */
        }
        
        /* Stili per le colonne originali */
        .upload-component { 
            padding: 20px; border-radius: var(--border-radius); text-align: center; 
            max-width: 400px; width: 100%;
        }
        .upload-area {
            background-color: #e9eff5; padding: 40px 20px; border-radius: var(--border-radius);
            margin-bottom: 20px; height: 170px; display: flex; flex-direction: column;
            justify-content: center; align-items: center; cursor: pointer; transition: opacity 0.2s;
        }
        .upload-icon { font-size: 4.5em; color: var(--brand-color); transition: transform 0.8s ease-in-out; }
        /* Animazione Rotazione Icona */
        .rotate-paper {
            animation: rotate-icon 1.5s infinite linear;
        }
        @keyframes rotate-icon {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        #fileInput { display: none; }
        .results-box {
            padding: 25px; border: 1px solid #ddd; background-color: #f7f7f7;
            border-radius: var(--border-radius); text-align: left; margin-bottom: 25px;
        }
        .kpi-title { font-size: 1.25em; font-weight: 600; color: var(--brand-color); margin-bottom: 12px; }
        .kpi-metric { font-size: 2em; font-weight: 900; color: var(--cta-color); margin-bottom: 18px; }
        .kpi-list { list-style-type: none; padding: 0; font-size: 0.95em; color: var(--text-dark); }
        .kpi-list li { margin-bottom: 6px; }
        .cta-button-middle {
            background-color: var(--cta-color); color: white; padding: 14px 35px; border: none;
            border-radius: var(--border-radius); font-size: 1.15em; font-weight: 700; cursor: pointer;
            width: 85%; margin: 0 auto; display: block; transition: background-color 0.2s;
        }
        .cta-button-middle:hover { background-color: #2e9f5e; }
        .clausola-box { padding: 6px; margin-bottom: 6px; border-left: 4px solid; font-size: 0.85em; }
        .HIGH { border-color: var(--danger-color); background-color: #fae6e6; color: var(--danger-color); }
        .MEDIUM { border-color: var(--warning-color); background-color: #fff4d2; color: #c08500; }
        .LOW { border-color: #28a745; background-color: #e6f7e6; color: #28a745; }
        .NON-TROVATA { border-color: #999; background-color: #eee; color: #555; }
        
        /* NUOVI STILI PER LA BARRA DI CARICAMENTO */
        #statusFeedback {
            margin-top: 25px; 
            padding: 15px; 
            border-radius: var(--border-radius);
            font-weight: 600; 
            text-align: center; 
            display: none;
            /* Flexbox per allineare gli elementi */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .status-error { background-color: #fbe6e6; color: var(--danger-color); }
        .status-success { background-color: #d4edda; color: #155724; }

        /* Spinner (Cerchio Blu che Gira) */
        .spinner { 
            border: 4px solid #f3f3f3; 
            border-top: 4px solid var(--brand-color);
            border-radius: 50%; 
            width: 20px; 
            height: 20px; 
            animation: spin 1s linear infinite; 
            display: inline-block; 
            margin-right: 15px; /* Spazio a destra del testo */
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* Contenitore della barra di avanzamento */
        .loading-bar-container {
            width: 100%;
            height: 8px; /* Altezza della striscia */
            background-color: #ddd;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        /* Striscia che avanza */
        .loading-bar-fill {
            height: 100%;
            width: 30%; /* Larghezza iniziale */
            background-color: var(--brand-color);
            animation: move-bar 2s linear infinite; /* Animazione di movimento */
            border-radius: 4px;
        }

        /* Animazione per la linea che avanza (effetto indeterminato) */
        @keyframes move-bar {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Contenitore per il testo e lo spinner */
        .processing-content {
            display: flex;
            align-items: center;
            font-weight: 600;
            color: var(--text-dark); /* Colore del testo durante l'analisi */
            margin-bottom: 5px;
        }


        .ai-suggestion-box {
            padding: 15px;
            border: 1px dashed var(--brand-color);
            border-radius: var(--border-radius);
            margin-top: 20px;
            background-color: #e9f5ff;
            font-size: 0.9em;
        }
        
        .reset-button {
            background-color: var(--brand-color);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1.05em;
            font-weight: 700;
            cursor: pointer;
            width: 100%;
            margin-top: 30px;
            transition: background-color 0.2s;
            text-align: center;
            display: block; 
        }
        .reset-button:hover { 
            background-color: #337ab7; 
        }

        /* NUOVI STILI PER LA BARRA REPORT/GRAFICO */
        #reportNav {
            width: 100%;
            background-color: #2c3e50; /* Nero/scuro come richiesto */
            height: 40px;
            border-top-left-radius: var(--border-radius);
            border-top-right-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: flex-start;
            padding: 0;
            margin-top: -35px; /* Attacca alla parte superiore del content-card */
            box-sizing: border-box;
            max-width: 1200px;
            width: 95%;
            z-index: 10;
        }

        .nav-item {
            color: #ccc;
            padding: 0 20px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            height: 100%;
            display: flex;
            align-items: center;
            transition: background-color 0.2s, color 0.2s;
        }

        .nav-item:hover {
            color: var(--background-light);
        }

        .nav-item.active {
            color: var(--brand-color); /* Colore del brand per la scheda attiva */
            background-color: var(--background-light); /* Sfondo bianco per staccare dal report */
            border-bottom: 3px solid var(--brand-color);
            margin-bottom: -3px; /* Compensazione per il bordo */
        }
        /* Contenitore della report/chart che deve seguire la larghezza della tabella grossa */
        .report-content-wrapper {
             /* Il report-columns-layout ha una larghezza del 100% all'interno della content-card.
                Questo contenitore deve avere la stessa larghezza del reportContainer. */
             max-width: 100%; /* Si estende quanto la content-card */
             margin-top: 0;
        }
        /* Per fare in modo che la nav si allinei correttamente con report-columns-layout */
        #reportNav {
            margin-left: 35px;
            margin-top: -35px;
            width: calc(100% - 70px);
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
        }
        .results-box:nth-child(2) {
             /* Il report dettaglio si trova nella seconda colonna (2/3 della larghezza) */
             grid-column: 2 / 3;
        }
        #chartContent {
            /* Inizialmente nascosto */
            display: none;
            grid-column: 1 / 3; /* Occupa entrambe le colonne */
            padding: 25px;
            border: 1px solid #ddd;
            background-color: #f7f7f7;
            border-radius: var(--border-radius);
            text-align: center;
            min-height: 300px; /* Altezza minima per i grafici */
        }
    </style>
</head>
<body>

    <div class="top-bar">
        <div class="logo">Lux-Ai</div>
        
        <div class="top-bar-pitch">
            <h1>Risparmia 4+ Ore / Contratto. Analisi Rischi Legali in Minuti.</h1>
            <p>MVP Accessibile a tutti: Inizia ora la tua analisi.</p>
        </div>
        
        <div class="top-bar-nav">
            <a href="mailto:info@lux-ai.com" style="color: var(--brand-color); text-decoration: none;">Contatti</a> | 
            <a href="#" id="topNavAccessLink" style="color: var(--brand-color); text-decoration: none;">MVP Attiva</a>
        </div>
    </div>

    <div class="content-card">
        
        <div id="uploadContainer" class="single-column-layout">
            <div class="upload-component">
                <input type="file" id="fileInput" accept="application/pdf">
                
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon" id="uploadIcon">ðŸ“„</div>
                    <div id="uploadText">
                        <p style="font-weight: 600; color: var(--text-dark); margin-bottom: 5px;">Carica qui il tuo PDF Legale</p>
                        <p style="font-size: 0.9em; color: var(--text-light); margin-top: 0;">Solo PDF nativi per l'accuratezza massima. L'analisi Ã¨ sincrona.</p>
                    </div>
                </div>
                
                <button class="cta-button-middle" id="analyzeButton">Carica il tuo file</button>
                
                <div id="statusFeedback" class="status-processing" style="display: none; flex-direction: column; background-color: #f7f7f7; border: 1px solid #ddd;">
                    
                    <div class="processing-content">
                        <span id="spinner" class="spinner" style="display: none;"></span> 
                        <span id="statusText">Analisi AI in corso... Potrebbe volerci qualche secondo.</span>
                    </div>

                    <div class="loading-bar-container">
                        <div class="loading-bar-fill"></div>
                    </div>
                </div>

            </div>
        </div>

        <div id="reportNav" style="display: none;">
            <div class="nav-item active" id="navReport">Report</div>
            <div class="nav-item" id="navChart">Grafico</div>
        </div>

        <div id="reportContainer" class="report-columns-layout">
            
            <div id="reportContent" style="display: contents;">
                <div class="kpi-column">
                    <div class="results-box">
                        <div class="kpi-title">ROI & Efficienza</div>
                        <p style="font-size: 0.95em; color: var(--text-light); margin: 0;">Risparmio Economico Stimato:</p>
                        <div class="kpi-metric" id="roiMetric">â‚¬45.00</div>
                        
                        <p style="font-size: 0.95em; color: var(--text-light); margin: 0;">Tempo Analisi Risparmiato:</p>
                        <p style="font-size: 1.3em; font-weight: 700; color: var(--brand-color);" id="timeMetric">12 Minuti</p>
                    </div>
                    
                    <div class="results-box">
                        <div class="kpi-title">Stato Analisi</div>
                        <ul class="kpi-list" id="summaryList">
                            <li>â€¢ Focus Clausole Critiche: Liability & Indemnification</li>
                            <li>â€¢ Clausole Controllate: 2 (MVP)</li>
                            <li>â€¢ Rischio Complessivo: **Medio**</li>
                            <li id="riskScoreItem">Indice di Rischio: N/D / 100</li>
                            <li id="riskMotivationItem" style="font-size: 0.85em; color: var(--text-light);">Motivazione: Carica un file per l'analisi.</li>
                        </ul>
                    </div>
                </div>

                <div class="results-box" id="detailBox">
                    <div class="kpi-title">Report Dettaglio Rischi</div>
                    <div id="reportDetail">
                        <p style="font-size: 0.95em; color: var(--text-light); font-style: italic;">Carica un documento per visualizzare il report analitico su tutte le clausole critiche.</p>
                    </div>
                </div>
            </div>

            <div id="chartContent">
                <p class="kpi-title" style="margin-top: 0;">Analisi Grafica dei Rischi</p>
                <p style="font-size: 1em; color: var(--text-light); margin-top: 20px;">
                    Qui andranno i tuoi grafici (es. grafico a torta per la distribuzione dei rischi, istogramma, ecc.).
                    Per ora, questa Ã¨ solo un'area segnaposto per mantenere il codice pulito e funzionale.
                </p>
                </div>
            
            <button id="resetButton" class="reset-button" style="grid-column: 1 / 3;">
                Analizza un altro file
            </button>
        </div>
        
    </div>
    
    <div class="trust-section"></div>

</body>

<script>
    /* ---------------------------------------------------------------------- */
    /* CONFIGURAZIONE E UTILITY DOM */
    /* ---------------------------------------------------------------------- */
    
    const IS_USER_LOGGED_IN = true; 
    const WIX_LOGIN_URL = 'https://luxailegal.wixsite.com/my-site-9'; 

    const fileInput = document.getElementById('fileInput');
    const uploadArea = document.getElementById('uploadArea');
    const analyzeButton = document.getElementById('analyzeButton'); 
    const statusFeedback = document.getElementById('statusFeedback');
    const statusText = document.getElementById('statusText');
    const spinner = document.getElementById('spinner');

    // RIFERIMENTI AI NUOVI ELEMENTI DI CARICAMENTO
    const uploadIcon = document.getElementById('uploadIcon');
    const uploadText = document.getElementById('uploadText');

    // RIFERIMENTI AI CONTENITORI
    const uploadContainer = document.getElementById('uploadContainer');
    const reportContainer = document.getElementById('reportContainer');
    const resetButton = document.getElementById('resetButton'); 
    const reportNav = document.getElementById('reportNav'); // Nuova barra

    // RIFERIMENTI AI CONTENUTI DEL REPORT
    const roiMetric = document.getElementById('roiMetric');
    const timeMetric = document.getElementById('timeMetric');
    const summaryList = document.getElementById('summaryList');
    const reportDetail = document.getElementById('reportDetail');

    // RIFERIMENTI REPORT/GRAFICO
    const navReport = document.getElementById('navReport');
    const navChart = document.getElementById('navChart');
    const reportContent = document.getElementById('reportContent');
    const chartContent = document.getElementById('chartContent');

    // Stato per Report/Grafico (iniziale: 'report')
    let currentReportView = 'report'; 

    analyzeButton.textContent = 'Carica il tuo file';

    // ----------------------------------------------------------------------
    // FUNZIONI DI VISUALIZZAZIONE
    // ----------------------------------------------------------------------
    
    // Funzione per mostrare l'area di upload e nascondere il report
    function showUploadLayout() {
        uploadContainer.style.display = 'flex'; 
        reportNav.style.display = 'none'; // Nasconde la nav
        reportContainer.style.display = 'none';
        
        // Resetta l'input file e nasconde il feedback di stato
        showStatus('In attesa di caricamento...', 'processing', false);
        statusFeedback.style.display = 'none'; 
        fileInput.value = '';

        // Reset Caricamento
        analyzeButton.style.display = 'block'; // Mostra il bottone verde
        uploadText.style.display = 'block'; // Mostra il testo di "Carica qui..."
        uploadIcon.classList.remove('rotate-paper'); // Rimuove la rotazione
    }

    // Funzione per mostrare il report e nascondere l'upload
    function showReportLayout() {
        uploadContainer.style.display = 'none'; 
        reportNav.style.display = 'flex'; // Mostra la nav
        reportContainer.style.display = 'grid'; 
        // Assicura che venga visualizzato il contenuto corretto in base allo stato
        updateReportView(currentReportView);
    }
    
    // Al caricamento della pagina, mostra solo l'upload
    window.onload = showUploadLayout;
    
    // ----------------------------------------------------------------------
    // FUNZIONI DI STATO E RISULTATI (AGGIORNATA PER LA NUOVA BARRA E ROTAZIONE)
    // ----------------------------------------------------------------------

    function showStatus(message, type = 'processing', showSpinner = true) {
        
        // Se si passa a un'analisi o a un errore, assicurati che l'area di upload sia visibile
        if (type !== 'success') {
            uploadContainer.style.display = 'flex';
            reportNav.style.display = 'none';
            reportContainer.style.display = 'none';
        }

        statusFeedback.style.display = 'flex'; // Usiamo flex per il nuovo layout interno
        statusText.textContent = message;
        
        // Gestione della VISIBILITÃ€ e STILE
        const loadingBar = statusFeedback.querySelector('.loading-bar-container');
        const processingContent = statusFeedback.querySelector('.processing-content');

        if (type === 'processing') {
            // ModalitÃ  Analisi/Caricamento (Mostra Barra, Spinner, Rotazione Icona, NASCONDE Testo e Bottone)
            statusFeedback.className = ``; // Rimuovi classi di errore/successo per lo stato generico
            loadingBar.style.display = 'block';
            processingContent.style.display = 'flex';
            spinner.style.display = 'none'; // Il tuo spinner di testo lo mantengo nascosto per usare la rotazione sull'icona ðŸ“„
            statusFeedback.style.backgroundColor = '#f7f7f7'; // Reset colore di sfondo
            statusFeedback.style.border = '1px solid #ddd'; // Reset bordo
            statusText.style.color = 'var(--text-dark)';

            // MODIFICHE RICHIESTE:
            analyzeButton.style.display = 'none'; // NASCONDI BOTTONE VERDE
            uploadText.style.display = 'none'; // NASCONDI TESTO "Carica qui..."
            uploadIcon.classList.add('rotate-paper'); // INIZIA ROTAZIONE

        } else if (type === 'error') {
            // ModalitÃ  Errore (Nasconde Barra, Mostra Solo Testo Errore, Reset elementi)
            statusFeedback.className = `status-error`;
            loadingBar.style.display = 'none';
            processingContent.style.display = 'flex';
            spinner.style.display = 'none';
            statusText.style.color = 'var(--danger-color)'; // Colore del testo per errore

            // Reset Caricamento
            analyzeButton.style.display = 'block'; // Mostra il bottone verde
            uploadText.style.display = 'block'; // Mostra il testo di "Carica qui..."
            uploadIcon.classList.remove('rotate-paper'); // Rimuove la rotazione

        } else if (type === 'success') {
            // ModalitÃ  Successo (Nasconde tutto, viene mostrato solo il report)
            statusFeedback.className = `status-success`;
            loadingBar.style.display = 'none';
            processingContent.style.display = 'none'; // Nascondi il contenuto di processing
            
            // Il reset della rotazione e il bottone viene gestito dalla showReportLayout, ma lo metto qui per sicurezza
            analyzeButton.style.display = 'block'; 
            uploadText.style.display = 'block';
            uploadIcon.classList.remove('rotate-paper');
        }

        // Reset risultati statici
        if (type !== 'success') {
            roiMetric.textContent = 'â‚¬45.00'; 
            timeMetric.textContent = '12 Minuti'; 
            summaryList.innerHTML = `
                <li>â€¢ Focus Clausole Critiche: Liability & Indemnification</li>
                <li>â€¢ Clausole Controllate: 2 (MVP)</li>
                <li>â€¢ Rischio Complessivo: **Medio**</li>
                <li id="riskScoreItem">Indice di Rischio: N/D / 100</li>
                <li id="riskMotivationItem" style="font-size: 0.85em; color: var(--text-light);">Motivazione: Carica un file per l'analisi.</li>
            `;
            document.getElementById('riskScoreItem').textContent = 'Indice di Rischio: N/D / 100';
            document.getElementById('riskMotivationItem').innerHTML = 'Motivazione: Carica un file per l\'analisi.';
            reportDetail.innerHTML = `<p style="font-size: 0.95em; color: var(--text-light); font-style: italic;">Carica un documento per visualizzare il report analitico su tutte le clausole critiche.</p>`;
        }
    }

    function displayResult(result) {
        showReportLayout(); 

        const { 
            nome_documento, 
            risparmio_stimato_eur, 
            tempo_risparmiato_min, 
            analisi_clausole, 
            riassunto_breve,
            tempo_lettura_avvocato_stimato_min,
            rischio_complessivo_percentuale,
            motivazione_rischio_complessivo,
            suggerimenti_ai
        } = result;

        // --- COLONNA KPI ---
        roiMetric.textContent = `â‚¬${risparmio_stimato_eur.toFixed(2)}`;
        timeMetric.innerHTML = `
            ${tempo_risparmiato_min} Minuti 
            <span style="font-size: 0.7em; color: var(--text-light); display: block;">(Stimato Avv.: ${tempo_lettura_avvocato_stimato_min} min)</span>
        `;

        let riskSummaryText = 'BASSO';
        if (rischio_complessivo_percentuale >= 67) riskSummaryText = 'ALTO';
        else if (rischio_complessivo_percentuale >= 34) riskSummaryText = 'MEDIO';
        
        summaryList.innerHTML = `
            <li>â€¢ Documento: ${nome_documento.substring(0, 30)}...</li>
            <li>â€¢ Clausole Controllate: ${analisi_clausole.length}</li>
            <li>â€¢ Rischio Complessivo: **${riskSummaryText}**</li>
            <li id="riskScoreItem">Indice di Rischio: ${rischio_complessivo_percentuale} / 100</li>
            <li id="riskMotivationItem" style="font-size: 0.85em; color: var(--text-light);">Motivazione: ${motivazione_rischio_complessivo}</li>
        `;

        // --- COLONNA REPORT DETTAGLIO ---
        let detailHtml = `
            <div id="reportDetailContent">
                <p class="kpi-title" style="margin-top: 0;">Report Dettaglio Rischi</p>
                ${analisi_clausole.map(clausola => `
                    <div class="clausola-box ${clausola.rischio.replace(' ', '-')}">
                        <strong>${clausola.tipo} (${clausola.rischio})</strong><br>
                        ${clausola.rischio === 'NON TROVATA' ? 'Clausola non trovata nel documento.' : clausola.testo_clausola_esatta.substring(0, 100) + '...'}
                    </div>
                `).join('')}
                
                <div class="ai-suggestion-box">
                    <p class="kpi-title" style="margin-top: 0; color: var(--text-dark);">Sintesi Finale & Suggerimenti AI</p>
                    <p style="font-size: 0.9em; margin-bottom: 5px;">
                        Il documento presenta un livello di rischio complessivo **${riskSummaryText} (${rischio_complessivo_percentuale}/100)**.
                    </p>
                    <p style="font-size: 0.9em; font-weight: 600; color: var(--brand-color); margin-top: 10px; margin-bottom: 5px;">
                        Azioni Consigliate:
                    </p>
                    <p style="font-size: 0.9em; margin-top: 0;">${suggerimenti_ai}</p>
                    <p style="font-size: 0.8em; margin-top: 15px; font-style: italic;">Riassunto: ${riassunto_breve}</p>
                </div>
            </div>
        `;

        reportDetail.innerHTML = detailHtml;

        statusFeedback.style.display = 'none'; 
    }
    
    // ----------------------------------------------------------------------
    // FUNZIONE DI SWITCH REPORT/GRAFICO
    // ----------------------------------------------------------------------

    function updateReportView(view) {
        currentReportView = view;
        
        // Rimuove la classe 'active' da entrambi e la aggiunge solo a quello selezionato
        navReport.classList.remove('active');
        navChart.classList.remove('active');

        if (view === 'report') {
            navReport.classList.add('active');
            reportContent.style.display = 'contents'; // Per mantenere la grid-layout
            chartContent.style.display = 'none';
        } else if (view === 'chart') {
            navChart.classList.add('active');
            reportContent.style.display = 'none';
            chartContent.style.display = 'block'; // Lo mostro come block
        }
    }
    
    // Funzione fittizia di upload (simulazione)
    async function uploadFile(file) {
        // Avvia la nuova visualizzazione di caricamento
        showStatus('Analisi AI in corso... Potrebbe volerci qualche secondo.', 'processing', true);
        
        // Simulo la chiamata API
        await new Promise(resolve => setTimeout(resolve, 3000)); 

        const mockResult = { 
            nome_documento: file.name, 
            risparmio_stimato_eur: 55.50, 
            tempo_risparmiato_min: 15, 
            analisi_clausole: [
                { tipo: 'Limitation of Liability', rischio: 'HIGH', testo_clausola_esatta: 'Except in cases of wilful misconduct or gross negligence, the total liability of Vendor under this Agreement shall not exceed the fees paid by Customer in the six months preceding the event giving rise to the claim.' },
                { tipo: 'Indemnification', rischio: 'MEDIUM', testo_clausola_esatta: 'Customer shall indemnify, defend and hold harmless the Vendor from and against any and all claims, damages, losses, liabilities, costs and expenses arising out of or in connection with any third-party claim related to Customerâ€™s use of the Services.' },
                { tipo: 'Governing Law', rischio: 'LOW', testo_clausola_esatta: 'This Agreement shall be governed by and construed in accordance with the laws of Italy.' },
                { tipo: 'Termination', rischio: 'NON TROVATA', testo_clausola_esatta: '' }
            ],
            riassunto_breve: 'Il documento Ã¨ un Contratto di Servizi IT standard. Rischio principale nella clausola di Limitazione di ResponsabilitÃ  a favore del fornitore.',
            tempo_lettura_avvocato_stimato_min: 60,
            rischio_complessivo_percentuale: 55,
            motivazione_rischio_complessivo: 'Il punteggio Ã¨ stato aumentato a causa di una limitazione di responsabilitÃ  troppo restrittiva (HIGH risk) e una clausola di indennizzo sbilanciata (MEDIUM risk).',
            suggerimenti_ai: 'Si consiglia vivamente di rinegoziare la clausola di *Limitation of Liability* per includere un cap piÃ¹ alto o eccezioni per violazione di dati. La clausola di *Indemnification* dovrebbe essere bidirezionale.'
        };
        
        displayResult(mockResult);
    }


    // ----------------------------------------------------------------------
    // GESTORE DI EVENTI PRINCIPALE
    // ----------------------------------------------------------------------
    
    const ctaAction = (e) => {
        e.preventDefault();
        fileInput.click();
    }

    uploadArea.addEventListener('click', ctaAction);
    analyzeButton.addEventListener('click', ctaAction);
    
    fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
              uploadFile(file);
        }
    });
    
    // Evento Reset
    resetButton.addEventListener('click', showUploadLayout);

    // Eventi Navigazione Report/Grafico
    navReport.addEventListener('click', () => updateReportView('report'));
    navChart.addEventListener('click', () => updateReportView('chart'));

</script>
</html>